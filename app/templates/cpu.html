<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/open-iconic-bootstrap.min.css">
</head>
<body>
    {% include 'head.html' %}
    {% include 'left.html' %}
    <div class="col-sm-9 col-md-10">
    <div id="container" style="height:500%"></div>
    </div>
	<script type="text/javascript" src="/static/js/jquery.min.js"></script>
	<script type="text/javascript" src="/static/js/Chart.min.js"></script>
	<script type="text/javascript" src="/static/js/popper.min.js"></script>
	<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/static/js/echarts.common.min.js"></script>
        <script type="text/javascript">

            var dom = document.getElementById("container");
            var myChart = echarts.init(dom);

            myChart.setOption({

                // Make gradient line here
                visualMap: {
                    show: false,
                    Gtype: 'continuous',
                    seriesIndex: 0,
                    dimension: 0,
                    min: 0,
                    max: 400
                    },

                title: {
                    top:'0%',
                    left:'center',
                    text:'Gradient along the x axis'
                    },
                                
                tooltip: {
                    trigger: 'axis'
                },


                xAxis: {
                    data:[]
                },


                yAxis: {
                    splitLine: {show:false},
                },
                 

                grid:{
                    bottom: '10%'
                },

                series: {
                type: 'line',
                showSymbol: false,
                data: [],
                }
            })

            myChart.showLoading();

            var dateList = [];
            var valueList = [];
            
            var start = 0
            var url = '/cpu'
       
            setInterval(function(){
                $.post(url,{},function(ret){
                    var ret = JSON.parse(ret);
                    if(ret) {
                        start += 1; 
                        console.log("start", start)
                        if(start >= 10){
                            dateList.shift();
                            dateList.push(ret[0].dates);
                            console.log("datelist",dateList)
                            valueList.shift();
                            valueList.push(ret[0].values);
                            console.log("datelist",valueList)
                         }
                        else{
                            dateList.push(ret[0].dates);
                            valueList.push(ret[0].values);
                        }

                        myChart.hideLoading();
                        myChart.setOption({
                            xAxis:{
                                data: dateList
                            },
                            series: [{
                                type: 'line',
                                showSymbol: false,
                                data: valueList
                            }]
                        });
                    }
            })},1000);

</script>
</body>
</html>
